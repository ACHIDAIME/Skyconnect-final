#!/bin/bash
# Git Hook - Synchronise les fichiers media avant chaque commit si la fixture change

echo "üîÑ V√©rification de la fixture..."

# V√©rifier si la fixture a chang√©
if git diff --cached --name-only | grep -q "fixtures/initial_data.json"; then
    echo "‚úÖ Fixture d√©tect√©e - synchronisation des fichiers media..."
    
    # Ex√©cuter le script PowerShell depuis bash (fonctionne sur Git Bash)
    if command -v pwsh &> /dev/null; then
        pwsh -NoProfile -Command "& .\sync_media_files.ps1"
    elif command -v powershell &> /dev/null; then
        powershell -NoProfile -Command "& .\sync_media_files.ps1"
    else
        echo "‚ö†Ô∏è  PowerShell non trouv√© - synchronisation manuelle n√©cessaire"
        echo "   Ex√©cute: .\sync_media_files.ps1"
    fi
    
    # Ajouter les fichiers media modifi√©s au commit
    if git diff --name-only | grep -q "media/"; then
        echo "üìÅ Ajout des fichiers media au commit..."
        git add media/
    fi
else
    echo "‚ÑπÔ∏è  Pas de changement √† la fixture"
fi

exit 0
